# Руководство по установке и запуску GrMrMoney

## Быстрый старт

### 1. Установка PostgreSQL

#### Windows:
1. Скачайте PostgreSQL с https://www.postgresql.org/download/windows/
2. Запустите установщик
3. Запомните пароль для пользователя `postgres`
4. После установки PostgreSQL будет автоматически запущен

#### Создание базы данных:
Откройте PowerShell или CMD и выполните:

```bash
# Войдите в psql
psql -U postgres

# В psql создайте базу данных
CREATE DATABASE grmrmoney;

# Выйдите из psql
\q
```

### 2. Настройка проекта

Убедитесь, что установлен Node.js 18 или выше:
```bash
node --version
```

Обновите `.env` файл с вашими настройками:

```env
DATABASE_URL="postgresql://postgres:ВАШ_ПАРОЛЬ@localhost:5432/grmrmoney"
NEXTAUTH_SECRET="сгенерируйте-случайную-строку"
NEXTAUTH_URL="http://localhost:3000"
TRON_NETWORK="shasta"
NODE_ENV="development"
```

Сгенерировать NEXTAUTH_SECRET можно так:
```bash
# В PowerShell
-join ((48..57) + (65..90) + (97..122) | Get-Random -Count 32 | ForEach-Object {[char]$_})

# Или онлайн на https://generate-secret.vercel.app/32
```

### 3. Применение миграций

```bash
npx prisma migrate dev --name init
```

Эта команда:
- Создаст таблицы в PostgreSQL
- Сгенерирует Prisma Client

### 4. Запуск приложения

```bash
npm run dev
```

Откройте браузер: http://localhost:3000

## Первое использование

### 1. Регистрация
- Перейдите на http://localhost:3000/register
- Создайте аккаунт с email и паролем

### 2. Создание первого направления
- Войдите в систему
- Нажмите "Создать направление"
- Введите название (например: "Мария - Fashion")
- Нажмите "Продолжить к созданию кошелька"

### 3. Сохранение Seed Phrase
- **ОЧЕНЬ ВАЖНО**: Система покажет 12 слов
- Запишите их на бумаге и храните в безопасном месте
- Эти слова — единственный способ восстановить доступ к кошельку
- Они больше НИКОГДА не будут показаны!

### 4. Установка мастер-пароля
- Придумайте надёжный пароль (минимум 8 символов)
- Этот пароль будет использоваться для шифрования всех ваших кошельков
- Запомните его! Без него вы не сможете отправлять транзакции

## Работа с кошельками

### Получение тестовых TRX (для оплаты комиссий)

1. Скопируйте адрес вашего кошелька из интерфейса
2. Перейдите на https://www.trongrid.io/shasta (для Shasta testnet)
3. Вставьте адрес и получите бесплатные TRX

### Получение тестовых USDT

Для тестирования на Shasta testnet можно:
1. Использовать faucet (если доступен)
2. Или создать второй кошелек и переводить между своими кошельками

### Отправка USDT

1. Откройте направление
2. Перейдите в "Настройки" и разблокируйте кошельки мастер-паролем
3. Вернитесь к направлению
4. Нажмите "Отправить USDT"
5. Введите адрес получателя и сумму
6. Подтвердите транзакцию

**Важно**: Убедитесь, что у вас достаточно TRX для оплаты комиссии (energy/bandwidth)!

## Мониторинг транзакций

Система автоматически отслеживает входящие транзакции. Для принудительной синхронизации:

```bash
# Вызовите API endpoint
curl http://localhost:3000/api/transactions/sync
```

Можно настроить автоматическую синхронизацию через cron job (для продакшена).

## Переход на Mainnet (РЕАЛЬНЫЕ деньги)

⚠️ **ВНИМАНИЕ**: На mainnet вы работаете с реальными деньгами!

1. Обновите `.env`:
```env
TRON_NETWORK="mainnet"
```

2. Перезапустите приложение

3. Создайте новые направления (кошельки на testnet НЕ совместимы с mainnet)

4. **Перед отправкой реальных средств**:
   - Протестируйте с минимальными суммами
   - Убедитесь, что у вас есть backup seed phrases
   - Проверьте адреса получателей несколько раз

## Резервное копирование

### Backup базы данных

```bash
# PostgreSQL backup
pg_dump -U postgres grmrmoney > backup.sql

# Восстановление
psql -U postgres grmrmoney < backup.sql
```

### Что нужно сохранять

✅ **Обязательно**:
- Seed phrases (12 слов) для каждого кошелька
- Мастер-пароль (в надёжном месте)
- Backup базы данных

❌ **НЕ нужно**:
- node_modules (можно переустановить через npm install)
- .next (генерируется автоматически)

## Устранение проблем

### "Can't reach database server"

Убедитесь, что PostgreSQL запущен:
```bash
# Windows - проверьте в Services (services.msc)
# Ищите "postgresql" и убедитесь, что статус "Running"
```

### "Invalid password" при входе

- Проверьте правильность email и пароля
- Пароль чувствителен к регистру

### "Insufficient energy" при отправке USDT

- У вас недостаточно TRX для оплаты комиссии
- Пополните TRX баланс кошелька

### Транзакции не появляются

- Дождитесь подтверждения в сети (обычно 1-2 минуты)
- Вызовите синхронизацию: `/api/transactions/sync`
- Проверьте транзакцию на https://tronscan.org (для mainnet) или https://shasta.tronscan.org (для testnet)

## Безопасность

### Рекомендации

1. **Seed phrases**:
   - Храните на бумаге, в сейфе
   - Никогда не храните в цифровом виде
   - Не делитесь ни с кем

2. **Мастер-пароль**:
   - Используйте уникальный пароль
   - Не используйте для других сервисов
   - Рассмотрите использование менеджера паролей

3. **Компьютер**:
   - Используйте антивирус
   - Не устанавливайте подозрительное ПО
   - Блокируйте компьютер при отсутствии

4. **Приложение**:
   - Блокируйте кошельки после работы (в Настройках)
   - Регулярно делайте backup БД
   - Для больших сумм рассмотрите hardware wallet

## Продакшн деплой

Для деплоя на production сервер (Vercel, Railway, и т.д.):

1. Настройте production PostgreSQL базу
2. Обновите переменные окружения
3. Установите `NODE_ENV="production"`
4. Сгенерируйте надёжный `NEXTAUTH_SECRET`
5. Настройте HTTPS (обязательно!)
6. Рассмотрите настройку cron job для синхронизации транзакций

## Поддержка

Если возникли проблемы:
1. Проверьте логи: консоль браузера (F12) и терминал с `npm run dev`
2. Убедитесь, что PostgreSQL запущен
3. Проверьте .env файл
4. Создайте Issue в репозитории проекта
